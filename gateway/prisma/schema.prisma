generator client {
  provider = "prisma-client-js"
}


datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model User {
  id          String   @id @default(uuid())
  email       String   @unique
  password    String   // Hashed with bcrypt
  name        String
  companyName String
  
  // API access
  apiKey      String   @unique @default(uuid())  // For programmatic access
  monoApiKey  String?                            // Their Mono API key

  monoCustomerId String? 

  isVerified  Boolean  @default(false)
  otp         String?
  otpExpiry   DateTime?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  bankAccounts BankAccount[]
  applications Application[]
}


model BankAccount {
  id    String      @id @default(uuid())
  monoAccountId     String  @unique  // The 'data.id' from the webhook
  institution       String?  // e.g., "Access Bank"
  accountName       String?
  accountNumber     String?
  balance  Int?      //Stored in kobo/cents

  userId   String
  user     User    @relation(fields: [userId], references: [id])

  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@index([userId])
  transactions   Transaction[]
}


model Application {
  id            String   @id @default(uuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id])
  
  // End user info (from lending company)
  endUserId     String   // Their customer's ID
  monoAccountId String   // Mono account to analyze
  amount        Int      // Loan amount requested
  
  // Analysis results
  status        String   // PENDING, PROCESSING, APPROVED, REJECTED
  score         Int?     // 0-100 risk score
  decision      Json?    // Detailed breakdown from Brain
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([userId])
  @@index([status])
}



model Transaction {
  id          String   @id @default(uuid())
  accountId   String
  bankAccount    BankAccount @relation(fields: [accountId], references: [monoAccountId])
  amount      Int
  type        String   // DEBIT, CREDIT
  description String
  date        DateTime
  category    String?  // BETTING, FOOD, TRANSPORT, etc
  createdAt   DateTime @default(now())
  
  @@index([accountId])
}